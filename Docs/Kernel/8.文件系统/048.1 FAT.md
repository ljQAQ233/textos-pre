# FAT

> File Allocation Table

---

* FAT12
* FAT16
* FAT32

# Read

## Allocation Table

位于保留区域之后, 在数据区之前, 一般有两个 FAT , FAT1 是主分配表, FAT2 是备份使用的, 我们只驱动 FAT1

FAT1 的每一项占用 4B, 开头的 8 个字节是文件系统保留项, 其中 第0项 为介质类型，第1项 为文件系统错误标志,用户的数据从第2项开始.

## Indexing...

目录项的读取的话, 假设我们有一个簇号, 那么 簇号就可以当作 FAT1 的索引, `FAT1[簇号]` 会告诉你当前簇的下一个部分在哪个簇. 当 "簇号" 是 0x0FFFFFFF 时, 说明已经没有下一个簇了.

伪代码如下:

```py

# first_data_sect
# fat_sect_idx -> the sector index of current part of FAT1
# sect_size -> is defaltly 512 (Byte)

while true:
    cluster = read_cluster(current)
    if entry_exist(cluster, name):
        return entry_get(cluster, name)
    else:
        if not (align_down(current, nr_aloc) <= fat_read[current] < align_down(current, nr_aloc) + nr_aloc):
            fat_read = read_sector(div_round_down(fat_base + fat_read[current] * 4, sect_size))
        current = fat_read[current % nr_aloc]
        if current is 0x0FFFFFFF:
            return none

# whatever it goes
return none
```

